!function(t,s){"object"==typeof exports&&"object"==typeof module?module.exports=s():"function"==typeof define&&define.amd?define([],s):"object"==typeof exports?exports.xspy=s():t.xspy=s()}(window,(function(){return function(t){var s={};function i(e){if(s[e])return s[e].exports;var h=s[e]={i:e,l:!1,exports:{}};return t[e].call(h.exports,h,h.exports,i),h.l=!0,h.exports}return i.m=t,i.c=s,i.d=function(t,s,e){i.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:e})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"h",{value:!0})},i.t=function(t,s){if(1&s&&(t=i(t)),8&s)return t;if(4&s&&"object"==typeof t&&t&&t.h)return t;var e=Object.create(null);if(i.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&s&&"string"!=typeof t)for(var h in t)i.d(e,h,function(s){return t[s]}.bind(null,h));return e},i.n=function(t){var s=t&&t.h?function(){return t.default}:function(){return t};return i.d(s,"a",s),s},i.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},i.p="",i(i.s=0)}([function(t,s,i){"use strict";i.r(s);class e{static enable(){window.XMLHttpRequest=e.u,window.fetch&&(window.fetch=e.j)}static disable(){window.XMLHttpRequest=e.OriginalXHR,window.fetch&&e.OriginalFetch&&(window.fetch=e.OriginalFetch)}static isEnabled(){return window.XMLHttpRequest===e.u}static setXMLHttpRequest(t){e.u=t}static setFetch(t){e.j=t}static getRequestListeners(){return e.R.slice()}static getResponseListeners(){return e.v.slice()}static onRequest(t,s){const i=this.R;i.indexOf(t)>-1||("number"==typeof s?i.splice(s,0,t):i.push(t))}static offRequest(t){this.O("request",t)}static onResponse(t,s){const i=this.v;i.indexOf(t)>-1||("number"==typeof s?i.splice(s,0,t):i.push(t))}static offResponse(t){this.O("response",t)}static clearAll(){e.clearRequestHandler(),e.clearResponseHandler()}static clearRequestHandler(){this.R=[]}static clearResponseHandler(){this.v=[]}static O(t,s){const i="request"===t?this.R:this.v;for(let t=0;t<i.length;t++)if(i[t]===s)return void i.splice(t,1)}}e.R=[],e.v=[],e.u=window.XMLHttpRequest,e.j=window.fetch,e.OriginalXHR=window.XMLHttpRequest,e.OriginalFetch=(window.fetch||function(){}).bind(window);const h="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent:"",n=(()=>{let t=parseInt((/msie (\d+)/.exec(h.toLowerCase())||[])[1],10);return isNaN(t)?(t=parseInt((/trident\/.*; rv:(\d+)/.exec(h.toLowerCase())||[])[1],10),!isNaN(t)&&t):t})();function r(t,s){return!1!==n&&(!s||("<"===t?n<s:"<="===t?n<=s:">"===t?n>s:">="===t?n>=s:n===s))}const o=t=>{try{if(!r()&&"undefined"!=typeof Event)return new Event(t);const s=window.document.createEvent("Event");return s.initEvent(t),s}catch(s){return{type:t}}},c=(t,s,i=!1,e=0)=>Object.assign(Object.assign({},o(t)),{type:t,target:null,loaded:s,lengthComputable:i,total:e});class a{constructor(){this.UNSENT=0,this.OPENED=1,this.HEADERS_RECEIVED=2,this.LOADING=3,this.DONE=4,this.g=new e.OriginalXHR,this.q={},this.T=0,this._=!1,this.H=null,this.L=null,this.M=a.X(this.g),this.k=a.S(),this.A="",this.F=null,this.readyState=0,this.status=0,this.statusText="",this.timeout=0,this.upload=this.g.upload,this.response="",this.responseType="",this.responseURL="",this.withCredentials=!1,this.onreadystatechange=null,this.onabort=null,this.onerror=null,this.onloadstart=null,this.onload=null,this.onloadend=null,this.ontimeout=null,this.onprogress=null,this.N()}get responseText(){if("text"===this.responseType||""===this.responseType)return this.A;if(r(">=",10))return this.A;const t=new Error("responseText is only available if responseType is '' or 'text'.");throw t.name="InvalidStateError",t}get responseXML(){if("document"===this.responseType||""===this.responseType)return this.F;if(r(">=",10))return this.F;const t=new Error("responseXML is only available if responseType is '' or 'document'.");throw t.name="InvalidStateError",t}N(){this.C=this.C.bind(this),this.D=this.D.bind(this);const t=t=>{this.addEventListener(t,this.C)};t("error"),t("timeout"),t("abort"),this.g.onreadystatechange=()=>{const t=this.g.readyState;t===this.HEADERS_RECEIVED?r("<=",9)&&!1===this.M.async||this.P():t===this.LOADING?this.P():t===this.DONE&&(this.L=!1,this.P(),this.V()),this.I(t)}}addEventListener(t,s,i){this.q[t]||(this.q[t]=[]),this.q[t].push(s)}removeEventListener(t,s,i){if(!this.q[t])return;const e=this.q[t].indexOf(s);e<0||this.q[t].splice(e,1)}dispatchEvent(t){if("object"!=typeof t)throw new TypeError("EventTarget.dispatchEvent: Argument 1 is not an object");const s="on"+t.type;if("onabort"===s||"onerror"===s||"onload"===s||"onloadend"===s||"onloadstart"===s||"onprogress"===s||"ontimeout"===s){const i=this[s];i&&i.call(this,t)}else if("onreadystatechange"===s){const i=this[s];i&&i.call(this,t)}const i=this.q[t.type];if(!i)return!0;for(let s=0;s<i.length;s++){i[s].call(this,t)}return!0}overrideMimeType(t){return this.g.overrideMimeType.call(this.g,t)}open(t,s,i,e,h){if(arguments.length<2)throw new TypeError("XMLHttpRequest.open: "+arguments.length+" is not a valid argument count for any overload");this.T=0,this.H=!1,this._=!1,this.L=!1,this.M=Object.assign(Object.assign({},a.X(this.g)),{headers:{},method:t,url:s,async:!1!==i,username:e,password:h}),this.k=Object.assign(Object.assign({},a.S()),{headers:{}}),this.I(this.OPENED)}send(t){if(this.T!==this.OPENED)throw new DOMException("XMLHttpRequest state must be OPENED");this.U(t),this.B();let s=!1;const i=()=>{if(s=!0,this.T===this.DONE)return;this.L=!0;const t=!1!==this.M.async;this.g.open(this.M.method,this.M.url,t,this.M.username,this.M.password),t&&(this.g.responseType=this.responseType,this.g.timeout=this.timeout),this.g.withCredentials=this.withCredentials,this.dispatchEvent(c("loadstart",0));const i=this.M.headers,e=i?Object.keys(i):[];for(let t=0;t<e.length;t++){const s=e[t],h=i[s];this.g.setRequestHeader(s,h)}this.g.send(this.M.body)},h=e.getRequestListeners();let n=0;const r=()=>{try{if(n>=h.length)return i();const t=h[n];if(t.length>=2){const s=this.D(()=>{n++,r()});return void t.call(this,this.M,s)}t.call(this,this.M),n++,r()}catch(t){console.warn("XMLHttpRequest: Exception in request handler",t),s||(n++,r())}};r()}setRequestHeader(t,s){if(this.readyState!==this.OPENED)throw new DOMException("XMLHttpRequest state must be OPENED");this.M.headers||(this.M.headers={});const i=t.toLowerCase();this.M.headers[i]&&(s=this.M.headers[i]+", "+s),this.M.headers[i]=s}getResponseHeader(t){const s=t.toLowerCase();if(this.readyState<this.HEADERS_RECEIVED||!(s in this.k.headers)){if(r("<=",9)){if(this.readyState<this.OPENED)throw new Error;return""}return null}return this.k.headers[s]}getAllResponseHeaders(){if(this.readyState<this.HEADERS_RECEIVED){if(r("<=",9)&&this.readyState<this.OPENED)throw new Error;return""}return(t=>{const s=[],i=Object.keys(t);for(let e=0;e<i.length;e++){const h=i[e],n=h.toLowerCase(),r=t[h];s.push(n+": "+r)}return s.join("\r\n")+"\r\n"})(this.k.headers)}abort(){this._=!0,this.status=0,this.readyState=this.UNSENT,this.T=this.UNSENT,this.L?this.g.abort():this.dispatchEvent(c("abort",0)),this.L=!1}static X(t){return{ajaxType:"xhr",headers:{},method:"GET",url:"",async:!0,timeout:0,upload:t.upload}}static S(){return{ajaxType:"xhr",status:0,statusText:"",finalUrl:"",responseType:"",headers:{}}}U(t){this.M.responseType=this.responseType,this.M.timeout=this.timeout,this.M.withCredentials=this.withCredentials,this.M.body=t,this.g.onabort="function"==typeof this.onabort?this.onabort.bind(this):null,this.g.onerror="function"==typeof this.onerror?this.onerror.bind(this):null,this.g.ontimeout="function"==typeof this.ontimeout?this.ontimeout.bind(this):null,this.g.onprogress="function"==typeof this.onprogress?this.onprogress.bind(this):null}B(){const t=t=>{const s=this.q[t];if(s&&!(s.length<1))for(let i=0;i<s.length;i++)this.g.addEventListener(t,s[i].bind(this))};t("abort"),t("error"),t("timeout"),t("progress")}D(t){const s=s=>{s&&"object"==typeof s?(this.dispatchEvent(c("loadstart",0)),this.k=Object.assign(Object.assign({},this.k),s),this.I(this.DONE),t()):t()};return s.moveToHeaderReceived=t=>{this.readyState>=this.HEADERS_RECEIVED||(this.k=Object.assign(Object.assign({},this.k),t),this.I(this.HEADERS_RECEIVED))},s.moveToLoading=t=>{this.readyState>=this.LOADING||(this.k=Object.assign(Object.assign({},this.k),t),this.I(this.LOADING))},s}G(t){return s=>{s&&"object"==typeof s?(this.k=Object.assign(Object.assign({},this.k),s),t()):t()}}P(){if(this.k.status=this.g.status,this._)return;this.k.statusText=this.g.statusText;const t=(t=>{const s=t.trim().split(/[\r\n]+/),i={};for(let t=0;t<s.length;t++){const e=s[t].split(": "),h=e.shift();h&&(i[h.toLowerCase()]=e.join(": "))}return i})(this.g.getAllResponseHeaders()),s=Object.keys(t);for(let i=0;i<s.length;i++){const e=s[i],h=t[e];this.k.headers[e]||(this.k.headers[e]=h)}}V(){this.g.responseType?"text"===this.g.responseType?(this.k.responseText=this.g.responseText,this.k.response=this.g.responseText):"document"===this.g.responseType?(this.k.responseXML=this.g.responseXML,this.k.response=this.g.responseXML):this.k.response=this.g.response:(this.k.responseText=this.g.responseText,this.k.responseXML=this.g.responseXML,this.k.response=this.g.responseText),"responseURL"in this.g&&(this.k.responseURL=this.g.responseURL)}J(){this.status=this.k.status,this.statusText=this.k.statusText}K(){"responseText"in this.k&&(this.A=this.k.responseText||""),"responseXML"in this.k&&(this.F=this.k.responseXML||null),"body"in this.k&&(this.response=this.k.body||null),"response"in this.k&&(this.response=this.k.response),"responseURL"in this.k&&(this.responseURL=this.k.responseURL||"")}C(){this.H=!0,this.T=this.UNSENT,this.readyState=this.UNSENT,this.status=0}W(){const t=o("readystatechange");if(this.T===this.OPENED)this.dispatchEvent(t);else if(this.T===this.HEADERS_RECEIVED)this.J(),this.dispatchEvent(t);else if(this.T===this.LOADING)this.J(),this.dispatchEvent(t);else if(this.T===this.DONE){this.J(),this.K();let s=!1;const i=()=>{s=!0,this.J(),this.K(),this.dispatchEvent(t);const i=()=>{this.H||this.dispatchEvent(c("load",0)),this.dispatchEvent(c("loadend",0))};!1===this.M.async?i():window.setTimeout(i,0)},h=e.getResponseListeners();let n=0;const r=()=>{try{if(n>=h.length)return i();const t=h[n];if(t.length>=3){const s=this.G(()=>{n++,r()});return void t.call(this,this.M,this.k,s)}t.call(this,this.M,this.k),n++,r()}catch(t){console.warn("XMLHttpRequest: Exception in response handler",t),s||(n++,r())}};r()}}I(t){for(;this.T<t&&this.T<this.DONE;)this.T++,this.readyState=this.T,this.W()}}a.UNSENT=0,a.OPENED=1,a.HEADERS_RECEIVED=2,a.LOADING=3,a.DONE=4;class u{constructor(t,s){this.k=new Response(t,s),this.Y=t,this.N=s,this.headers=new Headers(s?s.headers:void 0),this.ok=!1,this.redirected=!1,this.status=s&&s.status?s.status:0,this.statusText=s&&s.statusText?s.statusText:"",this.trailer=this.k.trailer,this.type="basic",this.url="",this.body=this.k.body,this.bodyUsed=this.k.bodyUsed}static error(){return Response.error()}static redirect(t,s){return Response.redirect(t,s)}clone(){return new u(this.Y,this.N)}arrayBuffer(){return this.k.arrayBuffer()}blob(){return this.k.blob()}formData(){return this.k.formData()}json(){return this.k.json()}text(){return this.k.text()}}class l{constructor(t,s){this.Z=t,this.N=s,this.dispatch=this.dispatch.bind(this),this.$=this.$.bind(this),this.D=this.D.bind(this),this.G=this.G.bind(this),this.M=l.X(t,s),this.k=l.S()}dispatch(){return new Promise((t,s)=>{const i=this.k;let h=!1;const n=()=>{h=!0,i===this.k?e.OriginalFetch(this.M.url,this.M).then(s=>{const i={};for(const t of s.headers.keys()){const e=s.headers.get(t);e&&(i[t]=e)}this.k={ajaxType:"fetch",status:s.status,statusText:s.statusText,headers:i,ok:s.ok,redirected:s.redirected,type:s.type,url:s.url,body:s.body},this.$().then(s=>{t(s)})}):this.$().then(s=>{t(s)})},r=e.getRequestListeners();let o=0;const c=()=>{try{if(o>=r.length)return n();const t=r[o];if(t.length>=2){const s=this.D(()=>{o++,c()});return void t.call({},this.M,s)}t.call({},this.M),o++,c()}catch(t){console.warn("XMLHttpRequest: Exception in request handler",t),h||(o++,c())}};c()})}$(){return new Promise(t=>{let s=!1;const i=()=>{s=!0;const i=new u(this.k.body,this.k);i.url=this.k.url,i.type=this.k.type,i.redirected=this.k.redirected,i.ok=this.k.ok,t(i)},h=e.getResponseListeners();let n=0;const r=()=>{try{if(n>=h.length)return i();const t=h[n];if(t.length>=3){const s=this.G(()=>{n++,r()});return void t.call({},this.M,this.k,s)}t.call({},this.M,this.k),n++,r()}catch(t){console.warn("XMLHttpRequest: Exception in request handler",t),s||(n++,r())}};r()})}static X(t,s){if("string"==typeof t){const i=Object.assign(Object.assign({},s||{}),{ajaxType:"fetch",headers:{},url:t});if(s&&s.headers){const t=s.headers instanceof Headers?s.headers:new Headers(s.headers),e=Array.from(t.entries());for(let t=0;t<e.length;t++){const s=e[t],h=s[0],n=s[1];n&&(i.headers[h]=n)}}return i}{const i=t.headers||(s&&s.headers?s.headers:null),e=Object.assign(Object.assign({},s||{}),{ajaxType:"fetch",method:t.method,url:t.url,timeout:0,headers:{},body:t.body,cache:t.cache,credentials:t.credentials,integrity:t.integrity,keepalive:t.keepalive,mode:t.mode,redirect:t.redirect,referrer:t.referrer,referrerPolicy:t.referrerPolicy,signal:t.signal});if(i){const t=Array.from(i.entries());for(let s=0;s<t.length;s++){const i=t[s],h=i[0],n=i[1];n&&(e.headers[h]=n)}}return e}}static S(){return{ajaxType:"fetch",status:0,statusText:"",headers:{},ok:!0,redirected:!1,type:"basic",url:"",body:null}}D(t){const s=s=>{s&&"object"==typeof s?(this.k=s,t()):t()};return s.moveToHeaderReceived=()=>{},s.moveToLoading=()=>{},s}G(t){return s=>{s&&"object"==typeof s?(this.k=s,t()):t()}}}e.setXMLHttpRequest(a),e.setFetch((function(t,s){return new l(t,s).dispatch()})),e.enable();s.default=e}]).default}));
//# sourceMappingURL=xspy.min.js.map