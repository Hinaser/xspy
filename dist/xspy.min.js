!function(t,s){"object"==typeof exports&&"object"==typeof module?module.exports=s():"function"==typeof define&&define.amd?define([],s):"object"==typeof exports?exports.xspy=s():t.xspy=s()}(window,(function(){return function(t){var s={};function i(e){if(s[e])return s[e].exports;var h=s[e]={i:e,l:!1,exports:{}};return t[e].call(h.exports,h,h.exports,i),h.l=!0,h.exports}return i.m=t,i.c=s,i.d=function(t,s,e){i.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:e})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"h",{value:!0})},i.t=function(t,s){if(1&s&&(t=i(t)),8&s)return t;if(4&s&&"object"==typeof t&&t&&t.h)return t;var e=Object.create(null);if(i.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&s&&"string"!=typeof t)for(var h in t)i.d(e,h,function(s){return t[s]}.bind(null,h));return e},i.n=function(t){var s=t&&t.h?function(){return t.default}:function(){return t};return i.d(s,"a",s),s},i.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},i.p="",i(i.s=0)}([function(t,s,i){"use strict";i.r(s);const e=(window.fetch||function(){}).bind(window);class h{static enable(){window.XMLHttpRequest=h.u,window.fetch&&(window.fetch=h.g)}static disable(){window.XMLHttpRequest=h.OriginalXHR,window.fetch&&h.OriginalFetch&&(window.fetch=h.OriginalFetch)}static isEnabled(){return window.XMLHttpRequest===h.u}static setXMLHttpRequest(t){h.u=t}static setFetch(t){h.g=t}static getRequestListeners(){return h.v.slice()}static getResponseListeners(){return h.j.slice()}static onRequest(t,s){const i=this.v;i.indexOf(t)>-1||("number"==typeof s?i.splice(s,0,t):i.push(t))}static offRequest(t){this.R("request",t)}static onResponse(t,s){const i=this.j;i.indexOf(t)>-1||("number"==typeof s?i.splice(s,0,t):i.push(t))}static offResponse(t){this.R("response",t)}static clearAll(){h.clearRequestHandler(),h.clearResponseHandler()}static clearRequestHandler(){this.v=[]}static clearResponseHandler(){this.j=[]}static R(t,s){const i="request"===t?this.v:this.j;for(let t=0;t<i.length;t++)if(i[t]===s)return void i.splice(t,1)}}h.v=[],h.j=[],h.u=window.XMLHttpRequest,h.g=window.fetch,h.OriginalXHR=window.XMLHttpRequest,h.OriginalFetch=e;const n=Date.now();class r{constructor(t,s){this.O=!1,this.T=!1,this.q=!1,this._=!1,this.H=!1,this.L=[],this.M=0,this.X=!0,this.P="",this.D=null,this.S=null,this.k=null,this.A=!0,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.C=Date.now()-n,this.P=t,this.O=s.bubbles,this.L=s.path,this.M=s.eventPhase,this.D=s.target,this.S=s.target,this.k=s.target}get bubbles(){return this.O}get cancelBubble(){return this.T}get cancelable(){return this.q}get composed(){return this._}get defaultPrevented(){return this.H}get eventPhase(){return this.M}get returnValue(){return this.X}get timeStamp(){return this.C}get type(){return this.P}get target(){return this.D}get currentTarget(){return this.S}get srcElement(){return this.k}get isTrusted(){return this.A}composedPath(){return this.L}initEvent(t,s,i){this.P=t,void 0!==s&&(this.O=s),void 0!==i&&(this.q=i)}preventDefault(){}stopImmediatePropagation(){this.T=!0}stopPropagation(){}}class o extends r{constructor(t,s){super(t,s),this.F=!0,this.N=0,this.V=0,this.F=s.lengthComputable,this.N=s.loaded,this.V=s.total}get lengthComputable(){return this.F}get loaded(){return this.N}get total(){return this.V}}const c="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent:"",a=(()=>{let t=parseInt((/msie (\d+)/.exec(c.toLowerCase())||[])[1],10);return isNaN(t)?(t=parseInt((/trident\/.*; rv:(\d+)/.exec(c.toLowerCase())||[])[1],10),!isNaN(t)&&t):t})();function u(t,s){return!1!==a&&(!s||("<"===t?a<s:"<="===t?a<=s:">"===t?a>s:">="===t?a>=s:a===s))}const l=(t,s,i,e,h,n)=>{const r={target:s,bubbles:i,path:[s],eventPhase:Event.AT_TARGET,lengthComputable:e,loaded:h,total:n};return new o(t,r)};class d{constructor(){this.UNSENT=0,this.OPENED=1,this.HEADERS_RECEIVED=2,this.LOADING=3,this.DONE=4,this.I=new h.OriginalXHR,this.B={},this.U=0,this.G=!1,this.J=null,this.K=null,this.W=d.Y(this.I),this.Z=d.$(),this.tt="",this.st=null,this.F=!1,this.N=0,this.V=0,this.readyState=0,this.status=0,this.statusText="",this.timeout=0,this.upload=this.I.upload,this.response="",this.responseType="",this.responseURL="",this.withCredentials=!1,this.onreadystatechange=null,this.onabort=null,this.onerror=null,this.onloadstart=null,this.onload=null,this.onloadend=null,this.ontimeout=null,this.onprogress=null,this.it()}get responseText(){if("text"===this.responseType||""===this.responseType)return this.tt;if(u(">=",10))return this.tt;const t=new Error("responseText is only available if responseType is '' or 'text'.");throw t.name="InvalidStateError",t}get responseXML(){if("document"===this.responseType||""===this.responseType)return this.st;if(u(">=",10))return this.st;const t=new Error("responseXML is only available if responseType is '' or 'document'.");throw t.name="InvalidStateError",t}it(){this.et=this.et.bind(this),this.ht=this.ht.bind(this),this.nt=this.nt.bind(this);const t=t=>{this.addEventListener(t,this.et)};t("error"),t("timeout"),t("abort"),this.I.onreadystatechange=()=>{const t=this.I.readyState;t===this.HEADERS_RECEIVED?u("<=",9)&&!1===this.W.async||this.rt():t===this.LOADING?this.rt():t===this.DONE&&(this.K=!1,this.rt(),this.ot()),this.ct(t)},this.I.addEventListener("progress",this.nt),this.I.addEventListener("load",this.nt)}addEventListener(t,s,i){this.B[t]||(this.B[t]=[]),this.B[t].push(s)}removeEventListener(t,s,i){if(!this.B[t])return;const e=this.B[t].indexOf(s);e<0||this.B[t].splice(e,1)}dispatchEvent(t){if("object"!=typeof t)throw new TypeError("EventTarget.dispatchEvent: Argument 1 is not an object");const s="on"+t.type;if("onabort"===s||"onerror"===s||"onload"===s||"onloadend"===s||"onloadstart"===s||"onprogress"===s||"ontimeout"===s){const i=this[s];i&&i.call(this,t)}else if("onreadystatechange"===s){const i=this[s];i&&i.call(this,t)}const i=this.B[t.type];if(!i)return!0;for(let s=0;s<i.length&&!t.cancelBubble;s++){i[s].call(this,t)}return!0}overrideMimeType(t){return this.I.overrideMimeType.call(this.I,t)}open(t,s,i,e,h){if(arguments.length<2)throw new TypeError("XMLHttpRequest.open: "+arguments.length+" is not a valid argument count for any overload");this.U=0,this.J=!1,this.G=!1,this.K=!1,this.W=Object.assign(Object.assign({},d.Y(this.I)),{headers:{},method:t,url:s,async:!1!==i,username:e,password:h}),this.Z=Object.assign(Object.assign({},d.$()),{headers:{}}),this.ct(this.OPENED)}send(t){if(this.U!==this.OPENED)throw new DOMException("XMLHttpRequest state must be OPENED");this.at(t),this.ut();let s=!1;const i=()=>{if(s=!0,this.U===this.DONE)return;this.K=!0;const t=!1!==this.W.async;this.I.open(this.W.method,this.W.url,t,this.W.username,this.W.password),t&&(this.I.responseType=this.responseType,this.I.timeout=this.timeout),this.I.withCredentials=this.withCredentials,this.dispatchEvent(l("loadstart",this,!1,!1,0,0));const i=this.W.headers,e=i?Object.keys(i):[];for(let t=0;t<e.length;t++){const s=e[t],h=i[s];this.I.setRequestHeader(s,h)}this.I.send(this.W.body)},e=h.getRequestListeners();let n=0;const r=()=>{try{if(n>=e.length)return i();const t=e[n];if(t.length>=2){const s=this.ht(()=>{n++,r()});return void t.call(this,this.W,s)}t.call(this,this.W),n++,r()}catch(t){console.warn("XMLHttpRequest: Exception in request handler",t),s||(n++,r())}};r()}setRequestHeader(t,s){if(this.readyState!==this.OPENED)throw new DOMException("XMLHttpRequest state must be OPENED");this.W.headers||(this.W.headers={});const i=t.toLowerCase();this.W.headers[i]&&(s=this.W.headers[i]+", "+s),this.W.headers[i]=s}getResponseHeader(t){const s=t.toLowerCase();if(this.readyState<this.HEADERS_RECEIVED||!(s in this.Z.headers)){if(u("<=",9)){if(this.readyState<this.OPENED)throw new Error;return""}return null}return this.Z.headers[s]}getAllResponseHeaders(){if(this.readyState<this.HEADERS_RECEIVED){if(u("<=",9)&&this.readyState<this.OPENED)throw new Error;return""}return(t=>{const s=[],i=Object.keys(t);for(let e=0;e<i.length;e++){const h=i[e],n=h.toLowerCase(),r=t[h];s.push(n+": "+r)}return s.join("\r\n")+"\r\n"})(this.Z.headers)}abort(){this.G=!0,this.status=0,this.readyState=this.UNSENT,this.U=this.UNSENT,this.K?this.I.abort():this.dispatchEvent(l("abort",this,u("=",11),!0,0,0)),this.K=!1}static Y(t){return{ajaxType:"xhr",headers:{},method:"GET",url:"",async:!0,timeout:0,upload:t.upload}}static $(){return{ajaxType:"xhr",status:0,statusText:"",finalUrl:"",responseType:"",headers:{}}}at(t){this.W.responseType=this.responseType,this.W.timeout=this.timeout,this.W.withCredentials=this.withCredentials,this.W.body=t,this.I.onabort="function"==typeof this.onabort?this.onabort.bind(this):null,this.I.onerror="function"==typeof this.onerror?this.onerror.bind(this):null,this.I.ontimeout="function"==typeof this.ontimeout?this.ontimeout.bind(this):null,this.I.onprogress="function"==typeof this.onprogress?this.onprogress.bind(this):null}ut(){const t=t=>{const s=this.B[t];if(s&&!(s.length<1))for(let i=0;i<s.length;i++)this.I.addEventListener(t,s[i].bind(this))};t("abort"),t("error"),t("timeout"),t("progress")}ht(t){const s=s=>{s&&"object"==typeof s?(this.dispatchEvent(l("loadstart",this,!1,!1,0,0)),this.Z=Object.assign(Object.assign({},this.Z),s),this.ct(this.DONE),t()):t()};return s.moveToHeaderReceived=t=>{this.readyState>=this.HEADERS_RECEIVED||(this.Z=Object.assign(Object.assign({},this.Z),t),this.ct(this.HEADERS_RECEIVED))},s.moveToLoading=t=>{this.readyState>=this.LOADING||(this.Z=Object.assign(Object.assign({},this.Z),t),this.ct(this.LOADING))},s}lt(t){return s=>{s&&"object"==typeof s?(this.Z=Object.assign(Object.assign({},this.Z),s),t()):t()}}rt(){if(this.Z.status=this.I.status,this.G)return;this.Z.statusText=this.I.statusText;const t=(t=>{const s=t.trim().split(/[\r\n]+/),i={};for(let t=0;t<s.length;t++){const e=s[t].split(": "),h=e.shift();h&&(i[h.toLowerCase()]=e.join(": "))}return i})(this.I.getAllResponseHeaders()),s=Object.keys(t);for(let i=0;i<s.length;i++){const e=s[i],h=t[e];this.Z.headers[e]||(this.Z.headers[e]=h)}}ot(){this.I.responseType?"text"===this.I.responseType?(this.Z.responseText=this.I.responseText,this.Z.response=this.I.responseText):"document"===this.I.responseType?(this.Z.responseXML=this.I.responseXML,this.Z.response=this.I.responseXML):this.Z.response=this.I.response:(this.Z.responseText=this.I.responseText,this.Z.responseXML=this.I.responseXML,this.Z.response=this.I.responseText),"responseURL"in this.I&&(this.Z.responseURL=this.I.responseURL)}nt(t){this.F=t.lengthComputable,this.N=t.loaded,this.V=t.total}dt(){this.status=this.Z.status,this.statusText=this.Z.statusText}ft(){"responseText"in this.Z&&(this.tt=this.Z.responseText||""),"responseXML"in this.Z&&(this.st=this.Z.responseXML||null),"body"in this.Z&&(this.response=this.Z.body||null),"response"in this.Z&&(this.response=this.Z.response),"responseURL"in this.Z&&(this.responseURL=this.Z.responseURL||"")}et(){this.J=!0,this.U=this.UNSENT,this.readyState=this.UNSENT,this.status=0}pt(){const t=((t,s,i)=>{const e={target:s,bubbles:i,path:[s],eventPhase:Event.AT_TARGET};return new r(t,e)})("readystatechange",this,u("=",11));if(this.U===this.OPENED)this.dispatchEvent(t);else if(this.U===this.HEADERS_RECEIVED)this.dt(),this.dispatchEvent(t);else if(this.U===this.LOADING)this.dt(),this.dispatchEvent(t);else if(this.U===this.DONE){this.dt(),this.ft();let s=!1;const i=()=>{s=!0,this.dt(),this.ft(),this.dispatchEvent(t);const i=()=>{this.J||this.dispatchEvent(l("load",this,!1,this.F,this.N,this.V)),this.dispatchEvent(l("loadend",this,!1,this.F,this.N,this.V))};!1===this.W.async?i():window.setTimeout(i,0)},e=h.getResponseListeners();let n=0;const r=()=>{try{if(n>=e.length)return i();const t=e[n];if(t.length>=3){const s=this.lt(()=>{n++,r()});return void t.call(this,this.W,this.Z,s)}t.call(this,this.W,this.Z),n++,r()}catch(t){console.warn("XMLHttpRequest: Exception in response handler",t),s||(n++,r())}};r()}}ct(t){for(;this.U<t&&this.U<this.DONE;)this.U++,this.readyState=this.U,this.pt()}}d.UNSENT=0,d.OPENED=1,d.HEADERS_RECEIVED=2,d.LOADING=3,d.DONE=4;class f{constructor(t,s){this.Z=new Response(t,s),this.bt=t,this.it=s,this.headers=new Headers(s?s.headers:void 0),this.ok=!1,this.redirected=!1,this.status=s&&s.status?s.status:0,this.statusText=s&&s.statusText?s.statusText:"",this.trailer=this.Z.trailer,this.type="basic",this.url="",this.body=this.Z.body,this.bodyUsed=this.Z.bodyUsed}static error(){return Response.error()}static redirect(t,s){return Response.redirect(t,s)}clone(){return new f(this.bt,this.it)}arrayBuffer(){return this.Z.arrayBuffer()}blob(){return this.Z.blob()}formData(){return this.Z.formData()}json(){return this.Z.json()}text(){return this.Z.text()}}class p{constructor(t,s){this.yt=t,this.it=s,this.dispatch=this.dispatch.bind(this),this.wt=this.wt.bind(this),this.ht=this.ht.bind(this),this.lt=this.lt.bind(this),this.W=p.Y(t,s),this.Z=p.$()}dispatch(){return new Promise((t,s)=>{const i=this.Z;let e=!1;const n=()=>{e=!0,i===this.Z?h.OriginalFetch(this.W.url,this.W).then(s=>{const i={};for(const t of s.headers.keys()){const e=s.headers.get(t);e&&(i[t]=e)}this.Z={ajaxType:"fetch",status:s.status,statusText:s.statusText,headers:i,ok:s.ok,redirected:s.redirected,type:s.type,url:s.url,body:s.body},this.wt().then(s=>{t(s)})}):this.wt().then(s=>{t(s)})},r=h.getRequestListeners();let o=0;const c=()=>{try{if(o>=r.length)return n();const t=r[o];if(t.length>=2){const s=this.ht(()=>{o++,c()});return void t.call({},this.W,s)}t.call({},this.W),o++,c()}catch(t){console.warn("XMLHttpRequest: Exception in request handler",t),e||(o++,c())}};c()})}wt(){return new Promise(t=>{let s=!1;const i=()=>{s=!0;const i=new f(this.Z.body,this.Z);i.url=this.Z.url,i.type=this.Z.type,i.redirected=this.Z.redirected,i.ok=this.Z.ok,t(i)},e=h.getResponseListeners();let n=0;const r=()=>{try{if(n>=e.length)return i();const t=e[n];if(t.length>=3){const s=this.lt(()=>{n++,r()});return void t.call({},this.W,this.Z,s)}t.call({},this.W,this.Z),n++,r()}catch(t){console.warn("XMLHttpRequest: Exception in request handler",t),s||(n++,r())}};r()})}static Y(t,s){if("string"==typeof t){const i=Object.assign(Object.assign({},s||{}),{ajaxType:"fetch",headers:{},url:t});if(s&&s.headers){const t=s.headers instanceof Headers?s.headers:new Headers(s.headers),e=Array.from(t.entries());for(let t=0;t<e.length;t++){const s=e[t],h=s[0],n=s[1];n&&(i.headers[h]=n)}}return i}{const i=t.headers||(s&&s.headers?s.headers:null),e=Object.assign(Object.assign({},s||{}),{ajaxType:"fetch",method:t.method,url:t.url,timeout:0,headers:{},body:t.body,cache:t.cache,credentials:t.credentials,integrity:t.integrity,keepalive:t.keepalive,mode:t.mode,redirect:t.redirect,referrer:t.referrer,referrerPolicy:t.referrerPolicy,signal:t.signal});if(i){const t=Array.from(i.entries());for(let s=0;s<t.length;s++){const i=t[s],h=i[0],n=i[1];n&&(e.headers[h]=n)}}return e}}static $(){return{ajaxType:"fetch",status:0,statusText:"",headers:{},ok:!0,redirected:!1,type:"basic",url:"",body:null}}ht(t){const s=s=>{s&&"object"==typeof s?(this.Z=s,t()):t()};return s.moveToHeaderReceived=()=>{},s.moveToLoading=()=>{},s}lt(t){return s=>{s&&"object"==typeof s?(this.Z=s,t()):t()}}}h.setXMLHttpRequest(d),h.setFetch((function(t,s){return new p(t,s).dispatch()})),h.enable();s.default=h}]).default}));
//# sourceMappingURL=xspy.min.js.map